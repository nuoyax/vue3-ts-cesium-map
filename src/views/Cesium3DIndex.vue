<template>
  <div class="Cesium3DIndex" id="cesiumContainer"></div>

  <div class="panel">
    <div class="leftPanel">
      <div class="panel-box">
        <!-- å·¦ä¸Šå¡ç‰‡ç¤ºä¾‹ -->
        <div class="card" style="text-align: left">
          <h3>è®¾å¤‡åˆ—è¡¨</h3>
          <table class="data-table">
            <thead>
              <tr>
                <th>è®¾å¤‡ID</th>
                <th>è®¾å¤‡åç§°</th>
                <th>ä½ç½®</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>001</td>
                <td>æµ·å£äººæ°‘å¹¿åœº-ARå®æ™¯ç›‘æ§</td>
                <td>æµ·å—çœæµ·å£å¸‚é¾™ååŒºäººæ°‘å¹¿åœº</td>
              </tr>
              <tr>
                <td>002</td>
                <td>ä¸‰äºšæ¹¾æµ·æ»©</td>
                <td>æµ·å—çœä¸‰äºšå¸‚å¤©æ¶¯åŒºä¸‰äºšæ¹¾æµ·æ»©</td>
              </tr>
              <tr>
                <td>003</td>
                <td>ç¼æµ·åšé³Œäºšæ´²è®ºå›ä¼šå€</td>
                <td>æµ·å—çœç¼æµ·å¸‚åšé³Œé•‡åšé³Œäºšæ´²è®ºå›ä¼šå€</td>
              </tr>
              <tr>
                <td>004</td>
                <td>æµ·å£è±ªåº­åŒ—è‹‘äºŒåŒº</td>
                <td>æµ·å—çœæµ·å£å¸‚ç¼å±±åŒºæµ·å£è±ªåº­åŒ—è‹‘äºŒåŒº</td>
              </tr>
              <tr>
                <td>005</td>
                <td>ä¸‰äºšå‡¤å‡°å›½é™…æœºåœº-èˆªç«™æ¥¼ç›‘æ§</td>
                <td>æµ·å—çœä¸‰äºšå¸‚å‰é˜³åŒºå‡¤å‡°è·¯</td>
              </tr>
              <tr>
                <td>006</td>
                <td>æµ·å£ç«è½¦ä¸œç«™-å‡ºå…¥å£ç›‘æ§</td>
                <td>æµ·å—çœæµ·å£å¸‚ç¼å±±åŒºæµ·å£ç«è½¦ä¸œç«™</td>
              </tr>
              <tr>
                <td>007</td>
                <td>äº”æŒ‡å±±äº‘é¡¶å¹¿åœº-ç›‘æ§</td>
                <td>æµ·å—çœäº”æŒ‡å±±å¸‚å—åœ£è·¯äº‘é¡¶å¹¿åœº</td>
              </tr>
              <tr>
                <td>008</td>
                <td>æ–‡æ˜Œèˆªå¤©åŸ-ç›‘æ§è®¾å¤‡</td>
                <td>æµ·å—çœæ–‡æ˜Œå¸‚æ–‡èˆªè·¯èˆªå¤©åŸæ ¸å¿ƒåŒº</td>
              </tr>
              <tr>
                <td>009</td>
                <td>å„‹å·ä¸œå¡å…¬å›­-ç›‘æ§</td>
                <td>æµ·å—çœå„‹å·å¸‚ä¸œå¡è·¯ä¸œå¡å…¬å›­</td>
              </tr>
              <tr>
                <td>010</td>
                <td>ä¸‡å®æ—¥æœˆæ¹¾æ™¯åŒº-ç›‘æ§</td>
                <td>æµ·å—çœä¸‡å®å¸‚æ—¥æœˆæ¹¾æ—…æ¸¸åŒºå…¥å£</td>
              </tr>
              <tr>
                <td>011</td>
                <td>ä¸œæ–¹å¸‚äººæ°‘å¹¿åœº-ç›‘æ§</td>
                <td>æµ·å—çœä¸œæ–¹å¸‚æ»¨æµ·å¤§é“äººæ°‘å¹¿åœº</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="panel-box">
        <div class="card" style="text-align: left">
          <h3>è®¾å¤‡ä¿¡æ¯</h3>
          <p>è®¾å¤‡åç§°: ä¸­å›½äººæ°‘è§£æ”¾å†›æ€»åŒ»é™¢æµ·å—åŒ»é™¢æ‘„åƒå¤´</p>
          <p>è®¾å¤‡ä½ç½®ï¼šæµ·å—çœä¸‰äºšå¸‚æµ·æ£ åŒºæ±Ÿæ—è·¯80å·</p>
          <p>è®¾å¤‡çŠ¶æ€ï¼šæ­£å¸¸</p>
          <img style="width: 100%" src="/1.jpg" />
        </div>
      </div>
    </div>

    <div class="rightPanel">
      <!-- å³ä¸Šè¡¨æ ¼å¡ç‰‡ -->
      <div class="panel-box">
        <div class="card">
          <h3>æŠ¥è­¦åˆ—è¡¨</h3>
          <table class="data-table">
            <thead>
              <tr>
                <th>æŠ¥è­¦ä¿¡æ¯</th>
                <th>ç­‰çº§</th>
                <th>å¤„ç†çŠ¶æ€</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>ç›‘æ§æ‘„åƒå¤´ç¦»çº¿</td>
                <td>é«˜</td>
                <td>æœªå¤„ç†</td>
              </tr>
              <tr>
                <td>æ¸©åº¦ä¼ æ„Ÿå™¨å¼‚å¸¸</td>
                <td>ä¸­</td>
                <td>å¤„ç†ä¸­</td>
              </tr>
              <tr>
                <td>é—¨ç¦æœªå…³é—­</td>
                <td>é«˜</td>
                <td>æœªå¤„ç†</td>
              </tr>
              <tr>
                <td>çƒŸé›¾æŠ¥è­¦è§¦å‘</td>
                <td>é«˜</td>
                <td>å·²å¤„ç†</td>
              </tr>
              <tr>
                <td>æ°´æµ¸ä¼ æ„Ÿå™¨è­¦æŠ¥</td>
                <td>ä¸­</td>
                <td>æœªå¤„ç†</td>
              </tr>
              <tr>
                <td>ç”µåŠ›å¼‚å¸¸æ³¢åŠ¨</td>
                <td>ä½</td>
                <td>å¤„ç†ä¸­</td>
              </tr>
              <tr>
                <td>çº¢å¤–æ¢æµ‹å™¨è¯¯æŠ¥</td>
                <td>ä½</td>
                <td>å·²å¤„ç†</td>
              </tr>
              <tr>
                <td>çƒŸé›¾ä¼ æ„Ÿå™¨è„æ±¡</td>
                <td>ä¸­</td>
                <td>æœªå¤„ç†</td>
              </tr>
              <tr>
                <td>é—¨ç¦åˆ·å¡å¼‚å¸¸</td>
                <td>é«˜</td>
                <td>å¤„ç†ä¸­</td>
              </tr>
              <tr>
                <td>ç”µåŠ›æ–­è·¯å™¨è­¦æŠ¥</td>
                <td>é«˜</td>
                <td>æœªå¤„ç†</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- å³ä¸‹EChartså¡ç‰‡ -->
      <div class="panel-box">
        <div class="card charts">
          <div id="pieChart" class="chart"></div>
          <div id="lineChart" class="chart"></div>
          <div id="pieChart2" class="chart"></div>
          <div id="lineChart2" class="chart"></div>
        </div>
      </div>
    </div>
  </div>

  <ShowLngLat ref="ShowLngLatRef" />
  <ButtonTools ref="ButtonToolsRef" />
</template>

<script lang="ts">
/* eslint-disable no-debugger */
import { GController } from "@/utils/ctrlCesium/Controller";
import {
  getBaseMapConfig,
  getBaseMapImageryList,
} from "@/utils/getFormatData/BaseMap";
import ShowLngLat from "@/components/ShowLngLat.vue"; // @ is an alias to /src
import ButtonTools from "@/components/ButtonTools.vue";
import Titleset from "@/utils/ctrlCesium/Titleset";
import Manager from "@/utils/ctrlCesium/effects/Manager";
import Primitive from "@/utils/ctrlCesium/model/Primitive";
import RoadNetwork from "@/utils/ctrlCesium/lines/RoadNetwork";
import { defineComponent, onBeforeMount, nextTick, ref, onMounted } from "vue";
declare const Cesium: any;

declare const echarts: any; // âœ… å…¨å±€ ECharts
export default defineComponent({
  name: "Cesium3DIndex",
  components: { ShowLngLat, ButtonTools },
  setup() {
    let viewer = null;
    const ShowLngLatRef = ref();
    const ButtonToolsRef = ref();

    const initMap = (BaseMapConfig: any, MapImageryList: any) => {
      viewer = GController.init(BaseMapConfig, MapImageryList);
      window.Gviewer = viewer; // å…¨å±€æ§åˆ¶å° è°ƒè¯•viewer
      // æ˜¾ç¤ºç»çº¬åº¦ç»‘å®šäº‹ä»¶
      ShowLngLatRef.value.initCesiumHandler(viewer);
      // é£åˆ°é…ç½®çš„åæ ‡
      ButtonToolsRef.value.flyTo();

      // ğŸ”¹ã€æ–°å¢ã€‘è®¾ç½®åˆå§‹è§†è§’ä½ç½®
      // setTimeout(() => {
      //   viewer.camera.setView({
      //     destination: Cesium.Cartesian3.fromDegrees(
      //       113.9524, // ç»åº¦
      //       22.5392, // çº¬åº¦
      //       12000 // é«˜åº¦ï¼ˆç±³ï¼‰
      //     ),
      //     orientation: {
      //       heading: Cesium.Math.toRadians(0.0), // æœå‘è§’
      //       pitch: Cesium.Math.toRadians(-45.0), // ä¿¯ä»°è§’
      //       roll: 0.0,
      //     },
      //   });
      // }, 1000);

      // å¤„ç† ç™½è†œ
      const GTitleset = new Titleset(viewer);
      GTitleset.init();

      // æ¨¡å‹List
      const GPrimitive = new Primitive(viewer);
      GPrimitive.init();

      // å¤„ç† é…ç½®å¥½çš„ç‚¹æ•ˆæœåˆ—è¡¨
      const GManager = new Manager(viewer);
      GManager.init();

      // å…¬è·¯æ•ˆæœ
      const GRoadNetwork = new RoadNetwork(viewer, "road");
      GRoadNetwork.init();
    };

    const initCharts = () => {
      if (!echarts) {
        console.error("å…¨å±€ echarts æœªå®šä¹‰ï¼Œè¯·æ£€æŸ¥æ˜¯å¦å¼•å…¥ ECharts è„šæœ¬");
        return;
      }

      const commonTextStyle = {
        fontSize: 10,
        color: "#fff",
        fontFamily: "Arial, sans-serif",
      };

      // é€šç”¨åˆå§‹åŒ–å‡½æ•°
      const createChart = (containerId: string, option: any) => {
        const chart = echarts.init(document.getElementById(containerId)!);
        chart.setOption(option);
        return chart;
      };

      // é¥¼å›¾é€šç”¨é…ç½®å‡½æ•°
      const pieOption = (title: string, data: any[]) => ({
        title: { text: title, left: "center", textStyle: commonTextStyle },
        tooltip: { trigger: "item", textStyle: commonTextStyle },
        legend: { show: false },
        series: [
          {
            type: "pie",
            radius: "60%",

            label: { show: false },
            data,
          },
        ],
      });

      // æŠ˜çº¿å›¾é€šç”¨é…ç½®å‡½æ•°
      const lineOption = (title: string, xData: any[], yData: any[]) => ({
        title: { text: title, left: "center", textStyle: commonTextStyle },
        tooltip: { textStyle: commonTextStyle },
        xAxis: { type: "category", data: xData, axisLabel: commonTextStyle },
        yAxis: { type: "value", axisLabel: commonTextStyle },
        legend: { show: false },
        series: [
          {
            data: yData,
            type: "line",
            smooth: true,
          },
        ],
      });

      // åˆå§‹åŒ–å›¾è¡¨
      const pie = createChart(
        "pieChart",
        pieOption("", [
          { value: 40, name: "A" },
          { value: 25, name: "B" },
          { value: 35, name: "C" },
        ])
      );

      const pie2 = createChart(
        "pieChart2",
        pieOption("", [
          { value: 40, name: "A" },
          { value: 25, name: "B" },
          { value: 35, name: "C" },
        ])
      );

      const line = createChart(
        "lineChart",
        lineOption(
          "",
          ["1æœˆ", "2æœˆ", "3æœˆ", "4æœˆ", "5æœˆ"],
          [120, 132, 101, 134, 90]
        )
      );
      const line2 = createChart(
        "lineChart2",
        lineOption(
          "",
          ["1æœˆ", "2æœˆ", "3æœˆ", "4æœˆ", "5æœˆ"],
          [120, 132, 101, 134, 90]
        )
      );

      window.addEventListener("resize", () => {
        pie.resize();
        pie2.resize();
        line.resize();
        line2.resize();
      });
    };

    onBeforeMount(() => {
      nextTick(async () => {
        const BaseMapConfig: any = await getBaseMapConfig();
        const MapImageryList: any = await getBaseMapImageryList();
        initMap(BaseMapConfig, MapImageryList);
      });
    });

    onMounted(() => {
      nextTick(() => {
        initCharts();
      });
    });
    return {
      ShowLngLatRef,
      ButtonToolsRef,
    };
  },
});
</script>
<style lang="scss" scoped>
.Cesium3DIndex {
  height: 100%;
}

.panel {
  pointer-events: none; // è®© panel ä¸æ‹¦æˆªé¼ æ ‡
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  z-index: 33;
  display: flex;
  flex-direction: row;
  justify-content: space-between;
}
.leftPanel,
.rightPanel {
  pointer-events: auto;
  color: white;
  width: 25%;
  height: 100vh;
  // background: rgba(#5e0ad4, 0.5);

  .panel-box {
    width: 100%;
    height: 50%;
    padding: 10px;
    box-sizing: border-box;

    .card {
      pointer-events: auto; // âœ… å¼€å¯ç‚¹å‡»
      cursor: pointer; // é¼ æ ‡æ‚¬åœæ˜¾ç¤ºæ‰‹å‹ï¼ˆå¯é€‰ï¼‰
      font-size: 10px;
      background: rgba(2, 2, 31, 0.5);
      border-radius: 10px;
      padding: 10px;
      padding-top: 2px;
      height: 100%;
      overflow: auto;
    }
  }

  .panel-box:first-child {
    // background: rgba(#0c18b9, 0.3);
  }
  .panel-box:last-child {
    // background: rgba(#1b379c, 0.3);
  }
}

.data-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 8px; // âœ… ç¼©å°å­—ä½“
  th,
  td {
    border: 1px solid #ddd;
    padding: 4px;
    text-align: center;

    white-space: nowrap; // å†…å®¹ä¸æ¢è¡Œ
    overflow: hidden; // è¶…å‡ºéšè—
    text-overflow: ellipsis; // è¶…å‡ºæ˜¾ç¤º...
    max-width: 150px; // å¯æ ¹æ®éœ€è¦è°ƒæ•´åˆ—å®½
  }
  th {
  }
}

.charts {
  display: flex;
  flex-wrap: wrap; // âœ… å…è®¸æ¢è¡Œ
  gap: 10px;
  .chart {
    flex: 1 1 45%; // âœ… å®½åº¦è‡³å°‘ 45%ï¼Œå¯ä»¥è‡ªé€‚åº”æ¢è¡Œ
  }
}
</style>
